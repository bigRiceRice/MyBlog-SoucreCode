---
title: åŸå‹ & ES5 çš„é‚£äº›ç»§æ‰¿æ¨¡å¼ä¸€è§ˆ
author: BigRice
date: 2023-02-01
location: äº‘æ¢¦æ³½
summary: æ ¹æ®çº¢å®ä¹¦ç¬¬ 8 ç« æç‚¼å‡ºæ¥çš„å…³äºåŸå‹ã€ç»§æ‰¿æ¨¡å¼çš„çŸ¥è¯†ç‚¹
tags:
    - çº¢å®ä¹¦
---

## åŸå‹

> åŸå‹å³æ„é€ å‡½æ•°èº«ä¸Šçš„ä¸€ä¸ªåä¸º `prototype` å±æ€§æŒ‡å‘çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­å­˜æ”¾ç€åœ¨å„ä¸ªå®ä¾‹ä¸­å…±äº«çš„å±æ€§ä¸æ–¹æ³•ã€‚

æ— è®ºä½•æ—¶ï¼Œåªè¦åˆ›å»ºäº†å¯¹è±¡ï¼ˆåŒ…æ‹¬å‡½æ•°ï¼Œå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼‰ï¼Œéƒ½ä¼šæŒ‰ç…§ç‰¹å®šçš„è§„åˆ™ä¸ºè¿™ä¸ªå‡½æ•°åˆ›å»ºä¸€ä¸ª prototype å±æ€§ï¼ˆæŒ‡å‘åŸå‹å¯¹è±¡ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰åŸå‹å¯¹è±¡è‡ªåŠ¨è·å¾—ä¸€ä¸ªåä¸º `constructor` å±æ€§ï¼ŒæŒ‡å›ä¸ä¹‹å…³è”çš„æ„é€ å‡½æ•°ã€‚

åœ¨è‡ªå®šä¹‰æ„é€ å‡½æ•°æ—¶ï¼ŒåŸå‹å¯¹è±¡é»˜è®¤åªä¼šè·å¾— `constructor` å±æ€§ï¼Œå…¶ä»–çš„æ‰€æœ‰æ–¹å¼éƒ½ç»§æ‰¿è‡ª Objectï¼Œæ¯æ¬¡è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹çš„å†…éƒ¨ `[[prototype]]` æŒ‡é’ˆå°±ä¼šè¢«èµ‹å€¼ä¸ºæ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚åœ¨åŸç”Ÿ JS ä¸­æ²¡æœ‰è®¿é—® `[[prototype]]` ç‰¹æ€§çš„æ ‡å‡†æ–¹å¼ï¼Œä½† Fixfoxã€Safariã€Chrome ä¼šåœ¨æ¯ä¸ªå¯¹è±¡ä¸Šæš´éœ² `__proto__` å±æ€§ï¼Œé€šè¿‡è¿™ä¸ªå±æ€§å¯ä»¥è®¿é—®åˆ°å¯¹è±¡çš„åŸå‹ã€‚

å…³é”®åœ¨äºä¸€ç‚¹ï¼š**å®ä¾‹ä¸æ„é€ å‡½æ•°åŸå‹ä¹‹é—´æœ‰ç›´æ¥çš„è”ç³»ï¼Œä½†å®ä¾‹ä¸æ„é€ å‡½æ•°ä¹‹é—´æ²¡æœ‰**ã€‚

![image-20230201175454377](https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202302011754454.png)

> åªæœ‰å®ä¾‹å¯¹è±¡æ‰ä¼šè¢«æ·»åŠ  `__proto__` å±æ€§ï¼Œæ„é€ å‡½æ•°é»˜è®¤æš´éœ² `prototype` ï¼Œä¹Ÿå°±æ²¡æœ‰ `__proto__` å­˜åœ¨çš„å¿…è¦äº†

## åŸå‹é“¾

æˆ‘ä»¬éƒ½çŸ¥é“ä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„ prototype æŒ‡å‘çš„æ˜¯æ„é€ å‡½æ•°çš„ prototypeï¼Œé‚£ä¹ˆè¿™ä¸ªæ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ä¸­è¿˜ä¼šé€šè¿‡ prototype å±æ€§é“¾æ¥åˆ° Objec.prototype ç›´åˆ° null çš„å‡ºç°ï¼ŒåŸå‹é“¾æ‰ç®—åˆ°å¤´äº†ã€‚æˆ‘ä»¬éœ€è¦è·å–ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå°±ä¼šæ²¿ç€åŸå‹é“¾ä¸æ–­å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ã€‚åˆæ¬¡ä¹‹å¤–ï¼ŒåŸå‹é“¾æ˜¯ ES6 ä¹‹å‰å®Œæˆç»§æ‰¿çš„ä¸»è¦æ–¹å¼ä¹‹ä¸€ã€‚

å‡è®¾æˆ‘æœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘å…ˆè‹¥æƒ³è®¿é—®è¿™ä¸ªå®ä¾‹ä¸Šçš„å±æ€§ï¼Œé‚£ä¹ˆé¦–å…ˆä¼šå»è¯¥å®ä¾‹å¯¹è±¡ä¸ŠæŸ¥æ‰¾ï¼Œå¦‚æœæœ‰å°±è¿”å›ï¼Œå¦‚æœæ²¡æœ‰å°±å»å¾€æ”¹æ„é€ å‡½æ•°çš„åŸå‹ï¼ˆ `prototype` ï¼‰ä¸ŠæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°å°±è¿”å›ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰å°±åœ¨è¿™ä¸ªåŸå‹çš„ `prototype` ä¸Šæ¥ç€æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°åŸå‹é“¾çš„æœ€é¡¶å±‚ `Object.prototype` ä¸Šã€‚é‚£ä¹ˆè¿™ä¸ªå±æ€§æŸ¥æ‰¾çš„è§„åˆ™å°±å¯ä»¥çœ‹å‡ºåŸå‹é“¾çš„å­˜åœ¨äº†ã€‚

## ES5 ç»§æ‰¿

## å‰è¨€

çºµè§‚ ECMAScript è§„èŒƒçš„å†æ¬¡å‘å¸ƒï¼Œæ¯ä¸ªç‰ˆæœ¬çš„ç‰¹æ€§ä¼¼ä¹éƒ½å‡ºäººæ„æ–™ï¼ŒECMAScript 5.1 å¹¶æ²¡æœ‰æ­£å¼æ”¯æŒé¢å‘å¯¹è±¡çš„ç»“æ„ï¼Œ ä¾‹å¦‚ç±»æˆ–ç»§æ‰¿ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æ¥ä¸‹æ¥å‡ èŠ‚ä¼šä»‹ç»çš„ï¼Œå·§å¦™è¿ç”¨åŸå‹å¼ç»§æ‰¿å¯ä»¥æˆåŠŸåœ°æ¨¡æ‹ŸåŒæ ·çš„è¡Œä¸ºã€‚

ECMAScript6 å¼€å§‹æ­£å¼æ”¯æŒç±»å’Œç»§æ‰¿ã€‚ES6 çš„ç±»ï¼Œæ—¨åœ¨å®Œå…¨æ¶µç›–ä¹‹å‰è§„èŒƒè®¾è®¡çš„åŸºäºåŸå‹çš„ç»§æ‰¿æ¨¡å¼ã€‚ä¸è®ºä»å“ªæ–¹é¢çœ‹ï¼ŒES6 çš„ç±»éƒ½ä»…ä»…å¼å°è£…äº† ES5.1 æ„é€ å‡½æ•°åŠ åŸå‹ç»§æ‰¿çš„**è¯­æ³•ç³–**ç½¢äº†ã€‚

> æ³¨æ„ï¼šä¸è¦è¯¯ä¼šï¼šé‡‡ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹æ¨¡å¼çš„ JavaScript ä»£ç è¿˜æ˜¯åº”è¯¥ä½¿ç”¨ ECMAScript6 çš„ç±»ã€‚ä½†ä¸ç®¡æ€ä¹ˆè¯´ï¼Œäº†è§£ ES6 ç±»å‡ºç°ä¹‹å‰çš„æƒ¯ä¾‹æ€»æ˜¯æœ‰ç›Šæ— å®³çš„ã€‚ç‰¹åˆ«æ˜¯ ES6 ç±»å®šä¹‰æœ¬èº«å°±ç›¸å½“äºå¯¹åŸæœ‰ç»“æ„çš„å°è£…ã€‚

### å‰ç½®çŸ¥è¯†

-   æ„é€ å‡½æ•°çš„è¿”å›å€¼å°†æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸æ˜¯å‡½æ•°ã€‚
-   JS ä¸­çš„ä»»ä½•ç±»å‹éƒ½æ˜¯å¯¹è±¡ï¼Œå‡½æ•°ä¹Ÿä¸ä¾‹å¤–ã€‚
-   ä»»ä½•å¯¹è±¡éƒ½å­˜åœ¨åŸå‹ä»¥åŠåŸå‹é“¾ã€‚

## å…³äºç»§æ‰¿

ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­è®¨è®ºæœ€å¤šçš„è¯é¢˜ã€‚å¾ˆå¤šé¢å‘å¯¹è±¡è¯­è¨€éƒ½æ”¯æŒä¸¤ç§ç»§æ‰¿ï¼šæ¥å£ç»§æ‰¿ä¸å®ç°ç»§æ‰¿ã€‚å‰è€…åªç»§æ‰¿æ–¹æ³•ç­¾åï¼Œåè€…ç»§æ‰¿å®é™…çš„æ–¹æ³•ã€‚ä½†æ¥å£ç»§æ‰¿åœ¨ ECMAScript ä¸­æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºå‡½æ•°æ²¡æœ‰ç­¾åã€‚å®ç°ç»§æ‰¿æ˜¯ ECMAScript å”¯ä¸€æ”¯æŒçš„æ–¹å¼ï¼Œè€Œè¿™ä¸»è¦æ˜¯é€šè¿‡åŸå‹é“¾å®ç°çš„ã€‚

åœ¨ ES5 æ—¶æœŸï¼Œæ€»å…±æœ‰ä»¥ä¸‹å‡ ç§ç»§æ‰¿æ¨¡å¼

-   åŸå‹é“¾ç»§æ‰¿
-   ç›—ç”¨æ„é€ å‡½æ•°ç»§æ‰¿
-   ç»„åˆç»§æ‰¿
-   åŸå‹å¼ç»§æ‰¿
-   å¯„ç”Ÿå¼ç»§æ‰¿
-   å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿

## åŸå‹é“¾ç»§æ‰¿

> ECMA-262 æŠŠ**åŸå‹é“¾**å®šä¹‰ä¸º ECMAScript çš„ä¸»è¦ç»§æ‰¿æ–¹å¼ï¼Œä¸‹é¢ä»»ä½•ä¸€æ ·ç»§æ‰¿æ¨¡å¼éƒ½æ˜¯åœ¨åŸå‹é“¾çš„åŸºç¡€ä¸Šå®ç°çš„ã€‚

åŸå‹é“¾ç»§æ‰¿çš„åŸºæœ¬æ€æƒ³æ˜¯é€šè¿‡åŸå‹ç»§æ‰¿å¤šä¸ªå¼•ç”¨ç±»å‹çš„å±æ€§å’Œæ–¹æ³•ã€‚å›æƒ³ä¸€ä¸‹æ„é€ å‡½æ•°ã€åŸå‹ã€å®ä¾‹ä¹‹é—´çš„å…³ç³»å°±å¯ä»¥çœ‹å‡ºåŸå‹é“¾ç»§æ‰¿æ˜¯ JS æ— å¤„ä¸åœ¨çš„ä¸œè¥¿ã€‚

è‹¥æƒ³åœ¨ä¸€æ®µåŸå‹é“¾ä¸­ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œä»£ç çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```js
function Person() {
    this.body = true;
}

Person.prototype.sayBody = function () {
    return this.body;
};

function Women() {
    this.sex = "female";
}
// ä¿®æ”¹åŸå‹é“¾ï¼Œä½¿ Anya ç»§æ‰¿ Person çš„å®ä¾‹
Women.prototype = new Person();
Women.prototype.saySex = function () {
    return this.sex;
};

const anya = new Women();
console.log(anya.saySex()); // 'female'
console.log(anya.sayBody()); // true
```

ä»¥ä¸Šä»£ç å®šä¹‰äº†ä¸¤ä¸ªç±»å‹ï¼šPerson è¶…ç±»ä¸ Women ç±»ï¼Œè¿™ä¸¤ä¸ªç±»å‹åˆ†åˆ«å®šä¹‰äº†ä¸€ä¸ªå±æ€§å’Œæ–¹æ³•ã€‚

ä»£ç ä¸­ Women ç±»é€šè¿‡åˆ›å»º Person ç±»çš„å®ä¾‹å¹¶å°†å®ƒèµ‹å€¼ç»™è‡ªå·±çš„åŸå‹ï¼Œå®ç°äº†å¯¹ Person è¶…ç±»çš„ç»§æ‰¿ã€‚ç„¶ååˆåˆ›å»ºäº†ä¸€ä¸ª anya å®ä¾‹å¯¹è±¡ã€‚å¦‚æœå°†è¿™æ®µå…³ç³»å¯è§†åŒ–ï¼Œå°†æ˜¯è¿™æ ·çš„ï¼š

![image-20230201230237910](https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202302012302972.png)

è¿™ä¸ªä¾‹å­ä¸­å®ç°ç»§æ‰¿çš„å…³é”®ï¼Œæ˜¯ Women ç±»å¹¶æ²¡æœ‰ä½¿ç”¨é»˜è®¤çš„åŸå‹ï¼Œè€Œæ˜¯å°†å®ƒæ›¿æ¢ä¸ºäº† Person çš„å®ä¾‹å¯¹è±¡ã€‚è¿™æ ·ä¸€æ¥ï¼ŒWomen çš„å®ä¾‹å¯¹è±¡ä¸ä»…èƒ½ä» Person çš„å®ä¾‹ä¸­ç»§æ‰¿å±æ€§å’Œæ–¹æ³•ï¼Œè€Œä¸”è¿˜é€šè¿‡åŸå‹é“¾ä¸ Person çš„åŸå‹æŒ‚ä¸Šäº†é’©ã€‚

äºæ˜¯ anya å®ä¾‹å¯¹è±¡å°±å¯ä»¥ä¸€è·¯é€šè¿‡åŸå‹é“¾æ¥æŸ¥æ‰¾å±æ€§ä¸æ–¹æ³•äº†ã€‚æˆ‘ä»¬å°è¯•è°ƒç”¨çš„ saySex()ï¼Œå…¶å®è°ƒç”¨çš„æ˜¯ Women.prototype ä¸Šçš„æ–¹æ³•ï¼Œè°ƒç”¨ sayBody() å…¶å®æ˜¯ Person.prototype ä¸Šçš„æ–¹æ³•ã€‚

ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°åœ¨ Person æ„é€ å‡½æ•°ä¸­å®šä¹‰çš„ body å±æ€§æ€ä¹ˆå­˜åœ¨äº† Women çš„åŸå‹ä¸Šï¼Œè¿™æ˜¯å› ä¸º Women çš„åŸå‹æ˜¯ Person çš„å®ä¾‹å¯¹è±¡ï¼Œé‚£ä¹ˆåŸæœ¬çš„ Person.body è‡ªç„¶è€Œç„¶æˆä¸ºäº† Women.prototype.bodyï¼Œè¿™å…¶å®æ˜¯åŸå‹é“¾ç»§æ‰¿çš„ä¸€ä¸ªç‘•ç–µï¼Œæˆ‘ä»¬å°†åœ¨åé¢çš„ç»§æ‰¿æ¨¡å¼ä¸­ä¿®å¤è¿™ä¸ªç‘•ç–µã€‚

### é—®é¢˜

åŸå‹é“¾ç»§æ‰¿å­˜åœ¨ç€ä¸€äº›é—®é¢˜ï¼š

åœ¨ä½¿ç”¨åŸå‹é“¾ç»§æ‰¿æ—¶ï¼Œå­ç±»åŸå‹å®é™…ä¸Šå˜æˆäº†è¶…ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆçˆ¶ç±»**å®ä¾‹ä¸­çš„å±æ€§å°±å˜æˆäº†åŸå‹å¯¹è±¡å±æ€§**

-   æ¯”å¦‚ body å±æ€§åº”è¯¥æ˜¯ä¸€ä¸ªå®ä¾‹å±æ€§ï¼Œä½†ç”±äºåˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹æ¥å®ç°ç»§æ‰¿ï¼Œè¿™ä¸ªæœ¬è¯¥æ˜¯å®ä¾‹å±æ€§çš„å±æ€§æ‘‡èº«ä¸€å˜æˆäº†åŸå‹å±æ€§ã€‚

ä»¥åŠå­ç±»å‘è¶…ç±»å®ä¾‹ä¼ å‚é—®é¢˜

-   å› ä¸ºæˆ‘ä»¬æ˜¯åœ¨å¤–éƒ¨ä¿®æ”¹çš„åŸå‹é“¾ï¼Œå¯¼è‡´æˆ‘ä»¬åœ¨ä½¿ç”¨ new Women() åˆ›å»ºå®ä¾‹æ—¶ï¼Œæ˜¯æ— æ³•ç»™è¶…ç±» new Person() ä¼ å‚çš„

åŒæ ·è¿˜æœ‰çš„ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ï¼š

å‡å¦‚åŸå‹ä¸­åŒ…å«å¼•ç”¨å€¼ï¼Œé‚£ä¹ˆæ¯ä¸ªå®ä¾‹éƒ½å°†å…±äº«è¿™ä¸ªå€¼ï¼Œå®ä¾‹ A ä¿®æ”¹äº†åŸå‹çš„å€¼ï¼Œå®ä¾‹ B ä¹Ÿä¼šåŒæ­¥æ”¹å˜ã€‚

-   åœ¨æŸäº›æƒ…å†µè¿™ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚

## ç›—ç”¨æ„é€ å‡½æ•°

ä¸ºäº†è§£å†³åŸå‹é“¾åŒ…å«åº”ç”¨å€¼å¯¼è‡´çš„å®ä¾‹å…±äº«é—®é¢˜ï¼Œä¸€ç§å«åšâ€œç›—ç”¨æ„é€ å‡½æ•°ï¼ˆconstructor stealingï¼‰â€ çš„æŠ€æœ¯åœ¨å¼€å‘ç¤¾åŒºæµè¡Œèµ·æ¥ã€‚

è¿™ç§æ€è·¯å¾ˆç®€å•ï¼šåœ¨å­ç±»æ„é€ å‡½æ•°ä¸­ä¹‹é—´ç›—ç”¨çˆ¶ç±»æ„é€ å‡½æ•°å¹¶è°ƒç”¨ã€‚å› ä¸ºæ¯•ç«Ÿå‡½æ•°å°±æ˜¯åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»£ç çš„ç®€å•å¯¹è±¡ï¼Œæ‰€æœ‰å¯ä»¥ä½¿ç”¨ `apply ` & `call` æ¥å®ç°åˆ›å»ºæ–°çš„ `this` è¾¾åˆ°â€œç›—ç”¨â€ã€‚æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š

```js
function Person() {
    this.colors = ["red", "blue"];
}

function Women() {
    // ç›—ç”¨ Person çš„æ„é€ å‡½æ•°å¹¶è°ƒç”¨å®ç°ç»§æ‰¿
    Person.call(this);
}
const anya = new Women();
anya.colors.push("blcak");
const goodwin = new Women();

console.log("anya", anya); //  ['red', 'blue', 'blcak']
console.log("goodwin", goodwin); // ['red', 'blue']
```

åœ¨ç¬¬ 7 è¡Œå±•ç¤ºäº†ç›—ç”¨æ„é€ å‡½æ•°çš„è°ƒç”¨ã€‚é€šè¿‡ä½¿ç”¨ `call` æ–¹æ³•ï¼ŒPerson æ„é€ å‡½æ•°åœ¨ä¸º Women çš„å®ä¾‹åˆ›å»ºçš„æ–°å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œäº†ã€‚è¿™ç›¸å½“äºæ€§çš„ Women å¯¹è±¡ä¸Šè¿è¡Œäº† Person ä¸­çš„æ‰€æœ‰åˆå§‹åŒ–ä»£ç ã€‚ç»“æœå°±æ˜¯æ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·± colors å±æ€§ï¼Œä¸”äº’ä¸å…±äº«ã€‚

### ä¼ é€’å‚æ•°

ç›¸æ¯”äºåŸå‹é“¾ç»§æ‰¿ï¼Œç›—ç”¨æ„é€ å‡½æ•°çš„ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯å¯ä»¥åœ¨å­ç±»æ„é€ å‡½æ•°ä¸­**å‘çˆ¶ç±»æ„é€ å‡½æ•°ä¼ å‚**ã€‚æ¥çœ‹ä¸‹é¢çš„ä¾‹å­

```js
function Person(name) {
    this.name = name;
}

function Women(name, age) {
    // ç»§æ‰¿ Person å¹¶ä¼ å‚
    Person.call(this, name);
    // è‡ªå®šä¹‰çš„å®ä¾‹å±æ€§
    this.age = age;
}

const anya = new Women("anya", 17);
console.log(anya.name); // 'anya'
console.log(anya.age); // 17
```

### é—®é¢˜

ç›—ç”¨æ„é€ å‡½æ•°çš„ä¸»è¦é—®é¢˜ï¼Œä¹Ÿæ˜¯ä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼è‡ªå®šä¹‰ç±»å‹çš„é—®é¢˜ï¼š

-   å› ä¸ºæ²¡æœ‰åŸå‹çš„å‚åŠ ï¼Œå¯¼è‡´çˆ¶ç±»ä¸Šæ‰€æœ‰å‡½æ•°/å±æ€§å¿…é¡»åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ï¼Œä¸€äº›å¯å¤ç”¨çš„å‡½æ•°æ— æ³•å®šä¹‰åœ¨åŸå‹ä¸Šã€‚
-   å› ä¸ºæ²¡æœ‰åŸå‹çš„å‚åŠ ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•è·å–çˆ¶ç±»åŸå‹ä¸Šçš„ä»»ä½•å±æ€§äº†ã€‚

## ğŸ­ ç»„åˆç»§æ‰¿

ç»„åˆç»§æ‰¿ï¼ˆæœ‰æ—¶å€™ä¹Ÿç§°ä¸ºä¸ºç»å…¸ç»§æ‰¿ï¼‰ç»¼åˆäº†åŸå‹é“¾å’Œç›—ç”¨æ„é€ å‡½æ•°ï¼Œå°†ä¸¤è€…çš„ä¼˜ç‚¹é›†ä¸­äº†èµ·æ¥ã€‚åŸºæœ¬çš„æ€è·¯æ˜¯ä½¿ç”¨åŸå‹é“¾ç»§æ‰¿åŸå‹ä¸Šçš„å±æ€§å’Œæ–¹æ³•ï¼Œè€Œé€šè¿‡ç›—ç”¨æ„é€ å‡½æ•°ç»§æ‰¿å®ä¾‹å±æ€§ã€‚

è¿™æ ·å³å¯ä»¥æŠŠæ–¹æ³•å®šä¹‰åœ¨åŸå‹ä¸Šä»¥å®ç°é‡ç”¨ï¼Œåˆå¯ä»¥è®©æ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„å±æ€§ã€‚æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š

```js
function Person(name) {
    this.name = name;
    this.colors = ["red", "blue"];
}

Person.prototype.sayName = function () {
    console.log(this.name);
};

function Women(name, age) {
    // ç»§æ‰¿å®ä¾‹å±æ€§
    Person.call(this, name);
    this.age = age;
}

// ç»§æ‰¿åŸå‹æ–¹æ³•
Women.prototype = new Person();
Women.prototype.sayAge = function () {
    console.log(this.age);
};

const anya = new Women("anya", 17);
anya.colors.push("black");
console.log(anya.colors); // ['red', 'blue', 'black']
anya.sayName(); // 'anya'
anya.sayAge(); // 17

const goodwin = new Women("goodwin", 20);
console.log(goodwin.colors); // ['red', 'blue']
goodwin.sayName(); // 'goodwin'
goodwin.sayAge(); // 20
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPerson æ„é€ å‡½æ•°å®šä¹‰äº†ä¸¤ä¸ªå±æ€§ï¼Œname å’Œ colorsï¼Œè€Œå®ƒçš„åŸå‹ä¸Šå®šä¹‰äº†ä¸€ä¸ª sayName() æ–¹æ³•ã€‚

è€Œåœ¨ Women æ„é€ å‡½æ•°ä¸­ï¼Œé€šè¿‡ç›—ç”¨æ„é€ å‡½æ•°ç»§æ‰¿äº†å®ä¾‹å±æ€§ï¼Œé€šè¿‡å°†åŸå‹èµ‹å€¼ä¸º Person çš„å®ä¾‹å¯¹è±¡æ¥ç»§æ‰¿ Person çš„åŸå‹æ–¹æ³•ã€‚

è¿™æ ·ä¸€æ¥ï¼ŒWomen çš„å®ä¾‹å¯ä»¥æ‹¥æœ‰ Women å’Œ Person æ„é€ å‡½æ•°ä¸­å®šä¹‰å±æ€§ï¼Œä¸”è¿˜èƒ½å…±äº«è°ƒç”¨ Person è¶…ç±»çš„åŸå‹æ–¹æ³• sayName()ã€‚

> ç»„åˆç»§æ‰¿å¼¥è¡¥äº†åŸå‹é“¾ç»§æ‰¿ä¸ç›—ç”¨æ„é€ å‡½æ•°çš„ä¸è¶³ä¹‹å¤„ï¼Œæ˜¯ JavaScript ä½¿ç”¨æœ€å¤šçš„ç»§æ‰¿æ–¹æ³•ã€‚è€Œä¸”ç»„åˆç»§æ‰¿ä¹Ÿä¿ç•™äº† instanceof() æ“ä½œç¬¦å’Œ isPrototype() æ–¹æ³•è¯†åˆ«åˆæˆå¯¹è±¡çš„èƒ½åŠ›ã€‚

### é—®é¢˜

ä¸€ä¸ªæ•ˆç‡é—®é¢˜ï¼Œç”±äºç»„åˆç»§æ‰¿

-   åœ¨ç»§æ‰¿å®ä¾‹å±æ€§æ—¶ç›—ç”¨äº†æ„é€ å‡½æ•°å¹¶è°ƒç”¨

-   åœ¨ç»§æ‰¿åŸå‹æ–¹æ³•æ—¶è°ƒç”¨äº† new Person()

è¿™å¯¼è‡´ Person çš„æ„é€ å‡½æ•°ä¸å¯é¿å…åœ°è¢«è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œç›´æ¥çš„å½±å“å°±æ˜¯ **å®šä¹‰åœ¨çˆ¶ç±»æ„é€ å‡½æ•°ä¸­å®ä¾‹å±æ€§å˜æˆäº†å­ç±»çš„åŸå‹å±æ€§** ï¼Œè™½ç„¶å­ç±»çš„å®ä¾‹å±æ€§é®è”½äº†åŸå‹ä¸Šçš„åŒåå±æ€§ï¼Œä½†åŸå‹ä¸Šçš„è¿™äº›å±æ€§æ˜¯å®Œå…¨æ²¡å¿…è¦è¢«å®šä¹‰çš„ã€‚

> è§£å†³æ–¹å¼å°±æ˜¯ä½¿ç”¨ **å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿**

ä¸€ä¸ªè§„èŒƒé—®é¢˜

-   Women.prototype å°†ä¸å­˜åœ¨ constructor å±æ€§ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªæ­£è§„çš„æ„é€ å‡½æ•°çš„åŸå‹çš„è¡¨ç°å½¢å¼ã€‚
-   å½“ç„¶è¿™ä¸ªé—®é¢˜å¯ä»¥ç›´æ¥è¢«è§£å†³æ‰

## åŸå‹å¼ç»§æ‰¿

2006 å¹´ï¼ŒDouglas Crockford å†™äº†ä¸€ç¯‡æ–‡ç« ï¼šã€ŠJavaScript ä¸­çš„åŸå‹å¼ç»§æ‰¿ã€‹ï¼ˆâ€œPrototypal Inheritance in JavaScriptâ€ï¼‰ã€‚è¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä¸€ç§ä¸æ¶‰åŠä¸¥æ ¼æ„ä¹‰ä¸Šæ„é€ å‡½æ•°çš„ç»§æ‰¿æ–¹å¼ã€‚å®ƒçš„å‡ºå‘ç‚¹æ˜¯å³ä½¿ä¸è‡ªå®šä¹‰ç±»å‹ä¹Ÿå¯ä»¥é€šè¿‡åŸå‹å®ç°**å¯¹è±¡ä¹‹é—´çš„ä¿¡æ¯å…±äº«**ã€‚æ–‡ç« åœ¨æœ€åç»™å‡ºäº†ä¸€ä¸ªå‡½æ•°ï¼š

```js
function object(o) {
    function F() {}
    F.prototype = o;
    return new F();
}
```

è¿™ä¸ª object() å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶æ„é€ å‡½æ•°ï¼Œå°†ä¼ å…¥çš„å¯¹è±¡èµ‹å€¼ç»™è¿™ä¸ªæ„é€ å‡½æ•°çš„åŸå‹ï¼Œéšåè¿”å›è¿™ä¸ªä¸´æ—¶å¯¹è±¡çš„å®ä¾‹ã€‚

æœ¬è´¨ä¸Šï¼Œobject() æ˜¯å¯¹ä¼ å…¥çš„å¯¹è±¡æ‰§è¡Œäº†ä¸€æ¬¡æµ…å¤åˆ¶ã€‚æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š

```js
let person = {
    name: "john",
    firends: ["goodwin", "timi", "Anya"],
};

const person1 = object(person);
person1.name = "rob";
person1.firends.push("adc");
const person2 = object(person1);
person1.name = "jack";
person1.firends.push("36D");

console.log(person1.firends); // ["goodwin", "timi", "Anya", "adc", "36D"]
console.log(person1);
```

åŸå‹å¼ç»§æ‰¿é€‚ç”¨äºè¿™ç§æƒ…å†µï¼šä½ æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œæƒ³åœ¨å®ƒçš„åŸºç¡€ä¸Šåœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚ä½ éœ€è¦æŠŠè¿™ä¸ªå¯¹è±¡å…ˆä¼ ç»™ object() å‡½æ•°ï¼Œç„¶åå†å¯¹è¿”å›çš„å¯¹è±¡è¿›è¡Œé€‚å½“ä¿®æ”¹ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œperson å®šä¹‰äº†å¦ä¸€ä¸ªå¯¹è±¡ä¹Ÿå¯ä»¥è®¿é—®çš„å…±äº«ä¿¡æ¯ï¼ŒæŠŠä»–ä¼ ç»™ obejct() å‡½æ•°åä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚è¿™ä¸ªæ–°å¯¹è±¡çš„åŸå‹æŒ‡å‘äº† person ï¼Œæ„å‘³ç€åŸå‹ä¸Šæ—¢æœ‰åŸå§‹å€¼å±æ€§åˆæœ‰å¼•ç”¨å€¼å±æ€§ã€‚è¿™ä¹Ÿæ„å‘³ç€ person.friends ä¸ä»…æ˜¯ person çš„å±æ€§ï¼Œè¿˜ä¼šå’Œ person1 ã€person2 å…±äº«ã€‚æ‰€ä»¥ä¸€å¥—æµç¨‹ä¸‹æ¥å®é™…å…‹éš†äº†ä¸¤ä¸ª personã€‚

> ES5 æ–°å¢çš„ Object.create() å°±æ˜¯å°†åŸå‹å¼ç»§æ‰¿çš„æ¦‚å¿µè§„èŒƒåŒ–äº†ã€‚

å¯„ç”Ÿå¼ç»§æ‰¿ï¼ˆobject()ï¼‰çš„åŸç†ååˆ†ç®€å•ï¼Œå°±æ˜¯ä¸æ–­å¯¹ä¸€ä¸ªå¯¹è±¡å¦‚åŒå¥—å¨ƒä¸€èˆ¬ä¸æ–­çš„å åŠ åŸå‹ï¼Œä½¿ä¸Šä¸€ä¸ªå¯¹è±¡æ‰€æœ‰å±æ€§éƒ½åœ¨åŸå‹ä¸Šå…±äº«ä¸‹å»ã€‚

## å¯„ç”Ÿå¼ç»§æ‰¿

ä¸åŸå‹å¼ç»§æ‰¿æ¯”è¾ƒæ¥è¿‘çš„ä¸€ç§ç»§æ‰¿æ–¹å¼æ˜¯**å¯„ç”Ÿå¼ç»§æ‰¿ï¼ˆparasitic inheritanceï¼‰**ï¼Œä¹Ÿæ˜¯ Crockfod åœ¨å½“æ—¶é¦–å€¡çš„ä¸€ç§æ¨¡å¼ã€‚

å¯„ç”Ÿå¼ç»§æ‰¿çš„èƒŒåçš„æ€è·¯ç±»ä¼¼äºå¯„ç”Ÿæ„é€ å‡½æ•°ä¸å·¥å‚æ¨¡å¼ï¼šåˆ›å»ºä¸€ä¸ªå®ç°ç»§æ‰¿çš„å‡½æ•°ï¼Œä»¥æŸç§æ–¹å¼å¢å¼ºå¯¹è±¡ï¼Œç„¶åè¿”å›è¿™ä¸ªå¯¹è±¡ã€‚

åŸºæœ¬çš„å¯„ç”Ÿç»§æ‰¿æ¨¡å¼å¦‚ä¸‹ï¼š

```js
function createAnother(original) {
    const clone = object(original); // é€šè¿‡è°ƒç”¨ object å åŠ ä¸€å±‚åŸå‹åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡
    clone.sayHello = () => console.log("Hello~"); // å¢å¼ºè¿™ä¸ªæ–°å¯¹è±¡
    // è¿”å›è¿™ä¸ªæ–°å¯¹è±¡
    return clone;
}
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒcreateAnother() å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯æ–°å¯¹è±¡çš„åŸºå‡†å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡ original ä¼šè¢«ä¼ é€’ç»™ object å‡½æ•°å åŠ ä¸€å±‚åŸå‹ï¼Œç„¶åå°†è¿”å›çš„æ–°å¯¹è±¡èµ‹å€¼ç»™ clone ã€‚æ¥ç€ç»™ clone æ·»åŠ ä¸€ä¸ª sayHello æ–¹æ³•ã€‚æœ€åè¿”å› cloneã€‚

æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨ createAnother() å‡½æ•°ï¼š

```js
let person = {
    name: "john",
    firends: ["goodwin", "timi", "Anya"],
};
const antherPerson = createAnother(person);
antherPerson.sayHello(); // 'Hello~'
```

å¯„ç”Ÿå¼ç»§æ‰¿åŒæ ·é€‚åˆä¸»è¦å…³æ³¨å¯¹è±¡ï¼Œè€Œä¸åœ¨ä¹ç±»å‹å’Œæ„é€ å‡½æ•°çš„åœºæ™¯ã€‚ä¸” object() å‡½æ•°ä¸æ˜¯å¯„ç”Ÿå¼ç»§æ‰¿æ‰€å¿…éœ€çš„ï¼Œä»»ä½•è¿”å›æ–°å¯¹è±¡çš„å‡½æ•°éƒ½å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ã€‚

## ğŸ§ å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿

å‰é¢è¯´åˆ°è¿‡ï¼Œç»„åˆç»§æ‰¿ä¹Ÿå­˜åœ¨ç€è¯¸å¤šé—®é¢˜ã€‚å¥½åœ¨æœ‰åŠæ³•è§£å†³è¿™äº›é—®é¢˜ã€‚

å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿é€šè¿‡ç›—ç”¨æ„é€ å‡½æ•°çš„æ€è·¯ç»§æ‰¿å±æ€§ï¼Œä½†ä½¿ç”¨ä½†ä½¿ç”¨æ··åˆå¼åŸå‹é“¾ç»§æ‰¿æ–¹å¼ã€‚å…¶æ€è·¯æ˜¯ä¸è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œè€Œæ˜¯ç›´æ¥å…‹éš†çˆ¶ç±»åŸå‹çš„å‰¯æœ¬ã€‚

è¯´åˆ°åº•å°±æ˜¯é€šè¿‡**å¯„ç”Ÿå¼ç»§æ‰¿æ¥ç»§æ‰¿çˆ¶ç±»åŸå‹**ï¼Œç„¶åå°†è¿”å›çš„å‡½æ•°å¯¹è±¡èµ‹å€¼ç»™å­ç±»åŸå‹ã€‚

å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿çš„åŸºæœ¬æ¨¡å¼å¦‚ä¸‹æ‰€ç¤ºï¼š

```js
function inheritPrototype(subType, superType) {
    function _object(o) {
        function F() {}
        F.prototype = o;
        return new F();
    }
    // åˆ›å»ºåŸå‹å‡½æ•°å¯¹è±¡
    const prototype = _object(superType.prototype);
    // è¡¥å…¨åŸå‹å‡½æ•°å¯¹è±¡
    prototype.constructor = superType;
    // èµ‹å€¼å­ç±»åŸå‹
    subType.prototype = prototype;
}
```

è¿™ä¸ª inheritPrototype() å‡½æ•°ä¸­å®ç°äº†å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿çš„æ ¸å¿ƒé€»è¾‘ã€‚

è¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šçˆ¶ç±»æ„é€ å‡½æ•°ä¸å­ç±»æ„é€ å‡½æ•°ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œç¬¬ä¸€æ­¥å…ˆåˆ›å»ºçˆ¶ç±»åŸå‹çš„ä¸€ä¸ªå‰¯æœ¬ã€‚ç„¶åï¼Œç»™è¿”å›çš„ prototype å¯¹è±¡è®¾ç½® constructor å±æ€§ï¼Œè§£å†³ç”±äºé‡å†™åŸå‹å¯¼è‡´é»˜è®¤ constructor ä¸¢å¤±çš„é—®é¢˜ã€‚æœ€åå°†æ–°åˆ›å»ºçš„å¯¹è±¡èµ‹ç»™å­ç±»å‹çš„åŸå‹ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼Œè°ƒç”¨ inheritPrototype() å¯ä»¥å®ç°å‰é¢ä¾‹å­ä¸­çš„å­ç±»å‹åŸå‹èµ‹å€¼ï¼š

```js
function Person(name) {
    this.name = name;
    this.colors = ["red", "blue"];
}

Person.prototype.sayName = function () {
    console.log(this.name);
};

function Women(name, age) {
    // ç»§æ‰¿å®ä¾‹å±æ€§
    Person.call(this, name);
    this.age = age;
}

// ç»§æ‰¿åŸå‹å±æ€§
function inheritPrototype(subType, superType) {
    function object(o) {
        function F() {}
        F.prototype = o;
        return new F();
    }
    // åˆ›å»ºåŸå‹å‡½æ•°å¯¹è±¡
    const prototype = object(superType.prototype);
    // è¡¥å…¨åŸå‹å‡½æ•°å¯¹è±¡
    prototype.constructor = subType;
    // èµ‹å€¼å­ç±»åŸå‹
    subType.prototype = prototype;
}
inheritPrototype(Women, Person);

Women.prototype.sayAge = function () {
    console.log(this.age);
};

const anya = new Women("anya", 17);
anya.colors.push("black");
console.log(anya.colors); // ['red', 'blue', 'black']
anya.sayName(); // 'anya'
anya.sayAge(); // 17
console.log("anya", anya);

const goodwin = new Women("goodwin", 20);
console.log(goodwin.colors); // ['red', 'blue']
goodwin.sayName(); // 'goodwin'
goodwin.sayAge(); // 20
```

ä½¿ç”¨å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿åï¼Œåªè°ƒç”¨äº†ä¸€æ¬¡ Person æ„é€ å‡½æ•°ï¼Œé¿å…äº† Women.prototype ä¸Šä¸å¿…è¦ä¹Ÿç”¨ä¸åˆ°çš„å±æ€§ã€‚

## æ¸©ä¹ 

![code](https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202302020121017.png)
